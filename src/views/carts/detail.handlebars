<h1>Carrito {{cartId}}</h1>

{{#if products.length}}
  <ul>
    {{#each products}}
      <li>
        {{this.product.title}} — ${{this.product.price}} × {{this.quantity}}
        <form
          action="/api/carts/{{../cartId}}/product/{{this.product._id}}"
          method="post"
          style="display:inline"
          data-method="delete">
          <button type="submit">Eliminar</button>
        </form>
      </li>
    {{/each}}
  </ul>
  <form action="/api/carts/{{cartId}}" method="post" data-method="delete">
    <button type="submit">Vaciar carrito</button>
  </form>
{{else}}
  <p>El carrito está vacío.</p>
{{/if}}
<button id="clearCart">Vaciar carrito</button>

<script>
  document.getElementById("clearCart").onclick = async () => {
    const cartId = "{{cartId}}";
    const res = await fetch(`/api/carts/${cartId}`, { method: "DELETE" });
    const json = await res.json();
    if (json.success) {
      localStorage.removeItem("cartId");
      window.location.reload();
    } else {
      alert("Error vaciando carrito");
    }
  };
</script>


<p><a href="/view/carts">Seguir comprando</a></p>
